{% extends "base.html" %}
{% block page_bg %}bg-work{% endblock %}

{% block content %}
<div class="card-container" style="max-width: 500px;">
    <form action="/update-profile" method="post" enctype="multipart/form-data">
        <label style="cursor: pointer;">
            <img src="{{ avatar }}" id="avatar-preview" style="width: 110px; height: 110px; border-radius: 50%; border: 3px solid #764ba2; object-fit: cover;">
            <input type="file" name="avatar_file" style="display:none;" onchange="preview(this)">
            <p style="font-size: 12px; color: #764ba2;">ç‚¹å‡»å¤´åƒæ›´æ¢</p>
        </label>

        <div class="form-group">
            <label>æ˜µç§°ä¿®æ”¹</label>
            <input type="text" name="nickname" class="form-input" value="{{ nickname }}">
        </div>
        <button type="submit" class="btn btn-primary" style="font-size: 12px; padding: 5px 15px;">ä¿å­˜èµ„æ–™</button>
    </form>

    <div style="text-align: left; margin-top: 30px; background: #fff; padding: 20px; border-radius: 20px;">
        <h4 style="color: #764ba2;">æˆ‘çš„ç­”é¢˜è®°å½•å­˜æ¡£</h4>
        {% for r in records %}
        <a href="/download-record/{{ r }}" target="_blank" style="display:block; margin: 10px 0; color: #34495e; text-decoration: none;">ğŸ“„ {{ r }}</a>
        {% endfor %}
    </div>

    {% if role == 'admin' %}
    <div style="margin-top: 30px; border-top: 2px dashed #eee; padding-top: 20px;">
        <form action="/reset-all" method="post">
            <button type="submit" class="btn" style="background:#ff4757; color:white; width: 100%;">åˆ·æ–°æ‰€æœ‰æˆå‘˜ç­”é¢˜æœºä¼š</button>
        </form>
    </div>
    {% endif %}

    <form action="/logout" method="post" style="margin-top: 20px;">
        <button type="submit" style="background:none; border:none; color:#999; cursor:pointer;">[ é€€å‡ºç™»å½• ]</button>
    </form>
</div>

<script>
function preview(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) { document.getElementById('avatar-preview').src = e.target.result; }
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
{% endblock %}